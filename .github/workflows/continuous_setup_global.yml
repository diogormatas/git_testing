name: Continuous Setup Global

on:
  workflow_dispatch:

jobs:
  setup_global:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        tools_list: [dbt, snowflake, sharepoint]

    steps:
      - name: Trigger Continuous Setup Base for each tool
        uses: actions/github-script@v4
        with:
          script: |
            const tools = ${{ toJSON(matrix.tools_list) }};
            for (const tool of tools) {
              console.log(`Starting Continuous Setup Base for ${tool}`);
              const createWorkflowRun = await octokit.rest.actions.createWorkflowDispatch({
                owner: context.repo.owner,
                repo: context.repo.repo,
                workflow_id: 'continuous_setup_base.yml',
                ref: context.ref,
                inputs: {
                  setup_tool: tool
                }
              });
              console.log(`Workflow run created for ${tool}`);
            }
